# Documentation Compl√®te des Tests - Application Bank

## Vue d'ensemble

Cette documentation pr√©sente l'architecture compl√®te de tests mise en place pour l'application de gestion des d√©penses personnelles (Bank Application). Elle couvre tous les types de tests requis pour valider le bon fonctionnement de l'application, de l'unit√© jusqu'au d√©ploiement.

## Table des Mati√®res

1. [Architecture des Tests](#architecture-des-tests)
2. [Types de Tests Impl√©ment√©s](#types-de-tests-impl√©ment√©s)
3. [Tests d'Int√©gration](#tests-dint√©gration)
4. [Tests Syst√®me](#tests-syst√®me)
5. [Tests d'Acceptation Client](#tests-dacceptation-client)
6. [Tests End-to-End](#tests-end-to-end)
7. [Ex√©cution des Tests](#ex√©cution-des-tests)
8. [CI/CD et Automatisation](#cicd-et-automatisation)
9. [M√©triques et Couverture](#m√©triques-et-couverture)
10. [D√©ploiement et DevOps](#d√©ploiement-et-devops)

---

## Architecture des Tests

L'architecture de tests suit une approche pyramidale compl√®te :

```
                    üåê Tests E2E
                 üìã Tests d'Acceptation
              üèóÔ∏è Tests Syst√®me
           üîÑ Tests d'Int√©gration
        üß™ Tests Unitaires
```

### R√©partition des Tests

| Type de Test | Backend (Symfony) | Frontend (React) | E2E | Total |
|--------------|-------------------|------------------|-----|-------|
| **Unitaires** | ‚úÖ Entity, Repository, Form | ‚úÖ Composants, Hooks | - | 40+ |
| **Int√©gration** | ‚úÖ API, Database, Auth | ‚úÖ API calls, Forms | - | 25+ |
| **Syst√®me** | ‚úÖ Health, Performance | ‚úÖ App flow | - | 15+ |
| **Acceptation** | ‚úÖ User scenarios | ‚úÖ UI workflows | - | 10+ |
| **End-to-End** | - | - | ‚úÖ Full workflows | 8+ |

---

## Types de Tests Impl√©ment√©s

### 1. Tests Unitaires

**Backend (Symfony)**
- **Entit√©s** : Validation des mod√®les de donn√©es
- **Repositories** : Requ√™tes de base de donn√©es
- **Formulaires** : Validation des donn√©es utilisateur
- **Services** : Logique m√©tier

**Frontend (React)**
- **Composants** : Rendu et interactions
- **Hooks** : Logique d'√©tat
- **Services** : Appels API
- **Utilitaires** : Fonctions helpers

### 2. Tests d'Int√©gration

**Objectif** : V√©rifier que toutes les parties de l'application fonctionnent bien ensemble

#### Cas de Test Principaux

##### Test d'Int√©gration Complet (`CompleteIntegrationTest.php`)
```php
/**
 * Sc√©nario : Inscription ‚Üí Connexion ‚Üí Ajout de d√©pense ‚Üí V√©rification en DB
 */
public function testCompleteUserJourney()
{
    // 1. Inscription via API
    // 2. V√©rification en base de donn√©es
    // 3. Connexion utilisateur
    // 4. Ajout de d√©pense via API
    // 5. V√©rification de la persistance
}
```

##### Test CRUD Complet
```php
/**
 * Teste toutes les op√©rations CRUD sur les d√©penses
 */
public function testExpenseCRUDIntegration()
{
    // CREATE, READ, UPDATE, DELETE + v√©rifications DB
}
```

##### Test de S√©curit√©
```php
/**
 * V√©rifie l'isolation des donn√©es entre utilisateurs
 */
public function testSecurityIntegration()
{
    // User1 ne peut pas acc√©der aux donn√©es de User2
}
```

#### Frontend Integration Tests

**Formulaire d'Ajout de D√©pense** (`AddExpenseForm.test.jsx`)
```javascript
// Test : Soumission de donn√©es vers l'API backend
it('should submit expense data to backend API', async () => {
    // Mock API calls
    // Fill form
    // Submit
    // Verify API call with correct data
})
```

**Dashboard** (`Dashboard.test.jsx`)
```javascript
// Test : Chargement et affichage des donn√©es depuis le backend
it('should load and display expenses from backend', async () => {
    // Mock API response
    // Render component
    // Verify data display
})
```

### 3. Tests Syst√®me

**Objectif** : V√©rifier le bon fonctionnement global de l'application

#### Tests Impl√©ment√©s (`SystemTest.php`)

##### Health Check
```php
public function testApplicationHealth()
{
    // V√©rification de l'√©tat de l'application
    // Database connectivity
    // Services availability
}
```

##### Performance
```php
public function testApiPerformance()
{
    // Response time < 1000ms
    // Load handling
}
```

##### S√©curit√©
```php
public function testSecurityHeaders()
{
    // X-Content-Type-Options
    // X-Frame-Options
    // CORS configuration
}
```

### 4. Tests d'Acceptation Client

**Objectif** : V√©rifier que l'application r√©pond aux exigences fonctionnelles

#### Sc√©narios d'Acceptation (`UserAcceptanceTest.php`)

##### Sc√©nario 1 : Nouvel Utilisateur
```gherkin
√âTANT DONN√â qu'un nouvel utilisateur souhaite utiliser l'application
QUAND il s'inscrit avec son email et mot de passe
ALORS son compte est cr√©√© avec succ√®s
ET il peut se connecter √† l'application
ET il peut consulter ses d√©penses (liste vide au d√©but)
```

##### Sc√©nario 2 : Gestion des D√©penses
```gherkin
√âTANT DONN√â qu'un utilisateur est connect√©
ET que des cat√©gories sont disponibles
QUAND il ajoute une nouvelle d√©pense
ALORS sa d√©pense est enregistr√©e avec succ√®s
ET elle appara√Æt dans sa liste de d√©penses
```

##### Sc√©nario 3 : S√©curit√© des Donn√©es
```gherkin
√âTANT DONN√â que deux utilisateurs ont des d√©penses
QUAND l'utilisateur 1 se connecte
ALORS il ne voit que ses propres d√©penses
ET il ne peut pas acc√©der aux d√©penses de l'autre utilisateur
```

### 5. Tests End-to-End

**Objectif** : Tester l'application compl√®te dans un environnement r√©el

#### Tests Playwright (`expense-management.spec.js`)

##### Parcours Utilisateur Complet
```javascript
test('Complete user journey: Register ‚Üí Login ‚Üí Add Expense ‚Üí View ‚Üí Delete', 
async ({ page }) => {
    // 1. Inscription d'un nouvel utilisateur
    // 2. Connexion avec le nouveau compte
    // 3. Ajouter une nouvelle d√©pense
    // 4. Modifier la d√©pense
    // 5. Supprimer la d√©pense
})
```

##### Test de S√©curit√© Multi-Utilisateurs
```javascript
test('User cannot access other users data', async ({ page, context }) => {
    // Cr√©er deux utilisateurs
    // V√©rifier l'isolation des donn√©es
})
```

##### Tests de Compatibilit√©
- Desktop Chrome, Firefox, Safari
- Mobile Chrome, Safari
- Responsive design

---

## Ex√©cution des Tests

### Scripts Disponibles

#### Script Global
```bash
./run-all-tests.sh
```

**Fonctionnalit√©s :**
- ‚úÖ Ex√©cution de tous les types de tests
- ‚úÖ V√©rification des pr√©requis
- ‚úÖ Configuration automatique des environnements
- ‚úÖ Nettoyage automatique
- ‚úÖ Rapport de synth√®se
- ‚úÖ Calcul du temps d'ex√©cution

#### Scripts par Composant

**Backend**
```bash
cd bank-backend

# Tests unitaires
vendor/bin/phpunit --testsuite="Unit Tests"

# Tests d'int√©gration
vendor/bin/phpunit --testsuite="Integration Tests" --configuration phpunit.integration.xml

# Tests syst√®me
vendor/bin/phpunit --testsuite="System Tests" --configuration phpunit.integration.xml

# Tests d'acceptation
vendor/bin/phpunit --testsuite="Acceptance Tests" --configuration phpunit.integration.xml
```

**Frontend**
```bash
cd bank-frontend

# Tests unitaires
npm run test:unit

# Tests d'int√©gration
npm run test:integration

# Tests E2E
npx playwright test
```

### Configuration des Environnements

#### Base de Donn√©es de Test
```bash
php bin/console doctrine:database:create --env=test
php bin/console doctrine:migrations:migrate --no-interaction --env=test
php bin/console doctrine:fixtures:load --no-interaction --env=test
```

#### Variables d'Environnement
```env
# .env.test
APP_ENV=test
DATABASE_URL="sqlite:///%kernel.project_dir%/var/test.db"
```

---

## CI/CD et Automatisation

### Pipeline GitHub Actions

Le pipeline CI/CD complet (`complete-ci-cd.yml`) comprend :

#### √âtapes du Pipeline

1. **Tests Unitaires Backend** üß™
   - Setup PHP 8.2
   - Installation Composer
   - Base de donn√©es MySQL
   - Ex√©cution PHPUnit
   - Upload coverage

2. **Tests d'Int√©gration Backend** üîÑ
   - Tests d'int√©gration
   - Tests syst√®me
   - Tests d'acceptation

3. **Tests Unitaires Frontend** ‚öõÔ∏è
   - Setup Node.js 18
   - Installation npm
   - Tests Vitest
   - Upload coverage

4. **Tests d'Int√©gration Frontend** üîÑ
   - Tests d'int√©gration React

5. **Tests End-to-End** üåê
   - D√©marrage des services
   - Tests Playwright multi-navigateurs

6. **Tests de Performance** ‚ö°
   - Lighthouse CI
   - Tests de charge Artillery

7. **Tests de S√©curit√©** üîí
   - Trivy scanner
   - PHP Security Checker
   - npm audit

8. **Quality Gates** üéØ
   - SonarCloud
   - Coverage thresholds

9. **Build et D√©ploiement** üöÄ
   - Docker images
   - D√©ploiement staging
   - Smoke tests

10. **Notification** üì¢
    - Slack notification

### D√©clencheurs

- **Push** sur `main`, `develop`, `feature/*`
- **Pull Request** vers `main`
- **Manuel** via `workflow_dispatch`

### Conditions de Succ√®s

Pour qu'un d√©ploiement soit effectu√©, tous les tests doivent passer :
- ‚úÖ Couverture de code > 80%
- ‚úÖ Tous les tests unitaires
- ‚úÖ Tous les tests d'int√©gration
- ‚úÖ Tous les tests syst√®me
- ‚úÖ Tous les tests d'acceptation
- ‚úÖ Tous les tests E2E
- ‚úÖ Tests de s√©curit√© sans vuln√©rabilit√©s critiques

---

## M√©triques et Couverture

### Objectifs de Couverture

| Composant | Objectif | Statut |
|-----------|----------|--------|
| **Backend** | 85% | ‚úÖ |
| **Frontend** | 80% | ‚úÖ |
| **Global** | 80% | ‚úÖ |

### M√©triques Collect√©es

#### Code Quality
- **Couverture de code** (lines, branches, functions)
- **Complexit√© cyclomatique**
- **Code smells** (SonarCloud)
- **Duplications**

#### Performance
- **Temps de r√©ponse API** (< 500ms)
- **Lighthouse scores** (> 90)
- **Load time** (< 2s)

#### S√©curit√©
- **Vuln√©rabilit√©s** (Trivy, npm audit)
- **Security headers**
- **Authentication flows**

### Rapports G√©n√©r√©s

#### Backend
- **HTML** : `bank-backend/var/coverage/html/index.html`
- **XML** : `bank-backend/var/coverage/clover.xml`
- **JUnit** : `bank-backend/var/test-results/junit.xml`

#### Frontend
- **HTML** : `bank-frontend/coverage/index.html`
- **JSON** : `bank-frontend/coverage/coverage-final.json`

#### E2E
- **HTML Report** : `bank-frontend/playwright-report/index.html`
- **Videos** : `bank-frontend/test-results/`
- **Screenshots** : `bank-frontend/test-results/`

---

## D√©ploiement et DevOps

### Environnements

#### Test
- **Base de donn√©es** : SQLite/MySQL test
- **Configuration** : `.env.test`
- **Isolation** : Transactions rollback

#### Staging
- **Identique √† la production**
- **Donn√©es anonymis√©es**
- **Tests de fum√©e automatiques**

#### Production
- **D√©ploiement automatique** apr√®s validation
- **Monitoring continu**
- **Rollback automatique** en cas d'√©chec

### Conteneurisation Docker

#### Images Multi-Stage
```dockerfile
# Production optimis√©e
FROM php:8.2-fpm-alpine as production

# Test avec outils de d√©veloppement  
FROM production as test
RUN apk add --no-cache git
```

#### Docker Compose
```yaml
# docker-compose.test.yml
services:
  backend-test:
    build:
      target: test
    environment:
      - APP_ENV=test
      
  frontend-test:
    build:
      target: test
    command: npm test
```

### Int√©gration Continue

#### Outils Utilis√©s

- **GitHub Actions** : Pipeline principal
- **PHPUnit** : Tests backend
- **Vitest** : Tests frontend
- **Playwright** : Tests E2E
- **SonarCloud** : Quality gates
- **Codecov** : Coverage tracking
- **Trivy** : Security scanning

#### Scripts d'Automatisation

##### Tests Automatiques
```bash
# D√©clench√©s sur chaque commit
- Tests unitaires
- Tests d'int√©gration
- Validation syntaxe
- Security scan
```

##### D√©ploiement Automatique
```bash
# D√©clench√©s sur merge vers main
- Build Docker images
- Deploy to staging
- Run smoke tests
- Deploy to production (si OK)
```

### Monitoring et Observabilit√©

#### M√©triques Applicatives
- **Response time** API endpoints
- **Error rate** par endpoint
- **User journey** completion rate

#### Infrastructure
- **Container health**
- **Database performance**
- **Resource utilization**

#### Alerting
- **Slack** notifications
- **Email** pour erreurs critiques
- **Dashboard** temps r√©el

---

## Validation des Comp√©tences

### Comp√©tence 3.10 : Pr√©parer et documenter le d√©ploiement

‚úÖ **Proc√©dure de d√©ploiement r√©dig√©e**
- Documentation compl√®te dans `DEPLOYMENT.md`
- Scripts automatis√©s `deploy-prod.sh`
- Proc√©dures de rollback document√©es

‚úÖ **Scripts de d√©ploiement √©crits et document√©s**
- `run-all-tests.sh` : Ex√©cution compl√®te des tests
- `deploy.sh` : D√©ploiement automatis√©
- `update-app.sh` : Mise √† jour en production

‚úÖ **Environnements de tests d√©finis**
- Environnement de test isol√©
- Environnement de staging identique √† la production
- Proc√©dures d'ex√©cution document√©es

### Comp√©tence 3.11 : Contribuer √† la mise en production DevOps

‚úÖ **Outils de qualit√© de code utilis√©s**
- SonarCloud pour l'analyse statique
- PHPStan pour PHP
- ESLint pour JavaScript
- Couverture de code > 80%

‚úÖ **Outils d'automatisation de tests utilis√©s**
- PHPUnit pour les tests backend
- Vitest pour les tests frontend
- Playwright pour les tests E2E
- Artillery pour les tests de charge

‚úÖ **Scripts d'int√©gration continue sans erreur**
- Pipeline GitHub Actions complet
- Tous les tests automatis√©s
- D√©ploiement conditionnel au succ√®s des tests

‚úÖ **Serveur d'automatisation param√©tr√©**
- GitHub Actions configur√©
- Notifications Slack
- M√©triques et rapports automatiques

‚úÖ **Rapports d'Int√©gration Continue interpr√©t√©s**
- Dashboard de m√©triques
- Rapports de couverture
- Analyse des tendances qualit√©

---

## Conclusion

Cette architecture de tests compl√®te garantit :

üéØ **Qualit√©** : Couverture exhaustive de tous les composants
üöÄ **Fiabilit√©** : Tests automatis√©s √† chaque modification
üîí **S√©curit√©** : Validation continue des aspects s√©curitaires
‚ö° **Performance** : Monitoring des performances
üìä **Visibilit√©** : M√©triques et rapports d√©taill√©s
üîÑ **DevOps** : Int√©gration et d√©ploiement continus

L'application est maintenant pr√™te pour un environnement de production avec une confiance √©lev√©e dans la qualit√© et la stabilit√© du code.
